const Discord = require("discord.js");
const config = require("../config.js");
const utils = require("../utils/utilManager.js");
const discordTranscripts = require('discord-html-transcripts');
const fs = require('fs');
const moment = require('moment');

function _0x1fca(){var _0x350e36=['roles','emoji','user','236JSuroC','setEmoji','823240QsEVyk','chnId','ticket_deleteBtn','addComponents','.html','guild','channel','setAuthor','archiveSystem','740406dtAuqt','setSeconds','ticketArchiveCategoryID','Talep\x20kapatıldı\x20-user-','getSeconds','fetch','333936hsZDxI','reply','get','37724SvpMKU','ButtonStyle','writeFile','member','setColor','messages','msgCount','map','channels','tickets','username','ActionRowBuilder','filter','parentId','setLabel','EmbedBuilder','closedEmbed','closingEmbed','onlyStaffsCanCloseTickets','fetchUser','support','author','\x20-\x20Archive','84UUMniq','isActive','193422OeLHeo','staffRoles','setStyle','desc','interaction.channel.name','`\x0a\x0aPuan\x20alan\x20yetkili','5886180kNqewN','content','toFixed','Secondary','sendToLog','>\x20→\x20`','close','createTranscript','members','editReply','push','sort','length','run','ticketPointsLogChnID','-timeout-','cancelbtn','some','forEach','date','log','color','replace','setDescription','reopenbtn','commands','closingTickets','name',':R>','Database','ticketCategoryID','send','staffStar','./views/','edit','permissionOverwrites','string','staffStarsSystem','ButtonBuilder','9355rKUEWZ','everyone','cache','getTime','closeLogNoPoints','-chn_name-','markModified','save','type','deletebtn','label','ticket_reopenBtn','general','setCustomId','has','setParent','19JsaTTX','err','findIndex','join','then'];_0x1fca=function(){return _0x350e36;};return _0x1fca();}function _0x17cf(_0x5614ac,_0x1c4d08){var _0x1fcae7=_0x1fca();return _0x17cf=function(_0x17cf8a,_0x1b59f5){_0x17cf8a=_0x17cf8a-0x15f;var _0x58f2fc=_0x1fcae7[_0x17cf8a];return _0x58f2fc;},_0x17cf(_0x5614ac,_0x1c4d08);}var _0x54c552=_0x17cf;(function(_0x255878,_0x380d03){var _0x59685b=_0x17cf,_0x411c20=_0x255878();while(!![]){try{var _0x2d720f=parseInt(_0x59685b(0x1c3))/0x1*(-parseInt(_0x59685b(0x16d))/0x2)+-parseInt(_0x59685b(0x164))/0x3+-parseInt(_0x59685b(0x1cb))/0x4*(parseInt(_0x59685b(0x1b3))/0x5)+-parseInt(_0x59685b(0x186))/0x6*(-parseInt(_0x59685b(0x184))/0x7)+-parseInt(_0x59685b(0x1cd))/0x8+parseInt(_0x59685b(0x16a))/0x9+parseInt(_0x59685b(0x18c))/0xa;if(_0x2d720f===_0x380d03)break;else _0x411c20['push'](_0x411c20['shift']());}catch(_0xd1bd55){_0x411c20['push'](_0x411c20['shift']());}}}(_0x1fca,0x2f62c),exports[_0x54c552(0x199)]=async(_0x3a8508,_0x4d80c7)=>{var _0x3a5de7=_0x54c552;if(_0x4d80c7[_0x3a5de7(0x161)][_0x3a5de7(0x17a)]!=config[_0x3a5de7(0x181)][_0x3a5de7(0x1aa)])return _0x4d80c7[_0x3a5de7(0x16b)]({'content':config[_0x3a5de7(0x172)]['general'][_0x3a5de7(0x1c4)]['ticketOnly'],'ephemeral':!![]});if(config['support'][_0x3a5de7(0x17f)]){if(!config[_0x3a5de7(0x181)]['staffRoles'][_0x3a5de7(0x19d)](_0x4c2de3=>_0x4d80c7[_0x3a5de7(0x170)][_0x3a5de7(0x1c8)]['cache'][_0x3a5de7(0x1c1)](_0x4c2de3)))return _0x4d80c7[_0x3a5de7(0x16b)]({'content':config['messages']['general']['err']['staffOnly'],'ephemeral':!![]});}const _0x241831=await _0x3a8508['Database']['fetchTicket'](_0x4d80c7[_0x3a5de7(0x161)]['id']);var _0x3cd903=new Discord['ButtonBuilder']()[_0x3a5de7(0x1c0)]('ticket_closeCancel')[_0x3a5de7(0x17b)](config['messages'][_0x3a5de7(0x1a5)]['close']['cancelbtn'][_0x3a5de7(0x1bd)])[_0x3a5de7(0x1cc)](config[_0x3a5de7(0x172)]['commands'][_0x3a5de7(0x192)][_0x3a5de7(0x19c)]['emoji'])['setStyle'](Discord[_0x3a5de7(0x16e)][_0x3a5de7(0x18f)]),_0x3f8973=new Discord[(_0x3a5de7(0x178))]()[_0x3a5de7(0x1d0)]([_0x3cd903]),_0x1065d2=new Date();_0x1065d2[_0x3a5de7(0x165)](_0x1065d2[_0x3a5de7(0x168)]()+0x111*0x28/0x3e8+0x3);const _0x103f36=new Discord['EmbedBuilder']()['setColor'](config[_0x3a5de7(0x172)][_0x3a5de7(0x1a5)][_0x3a5de7(0x192)][_0x3a5de7(0x17e)][_0x3a5de7(0x1a1)])[_0x3a5de7(0x1a3)](config[_0x3a5de7(0x172)]['commands'][_0x3a5de7(0x192)][_0x3a5de7(0x17e)]['desc'][_0x3a5de7(0x1a2)](_0x3a5de7(0x19b),'<t:'+(_0x1065d2[_0x3a5de7(0x1b6)]()/0x3e8)[_0x3a5de7(0x18e)](0x0)+_0x3a5de7(0x1a8)));_0x3a8508[_0x3a5de7(0x1a6)][_0x3a5de7(0x196)](_0x4d80c7[_0x3a5de7(0x161)]['id']);var _0x2114d7=await _0x4d80c7[_0x3a5de7(0x16b)]({'embeds':[_0x103f36],'components':[_0x3f8973]});setTimeout(async()=>{var _0x4e6b04=_0x3a5de7;if(!_0x3a8508['closingTickets']['some'](_0x20485a=>_0x20485a===_0x4d80c7[_0x4e6b04(0x161)]['id']))return;if(config['support']['saveTranscript']){const _0x5cda12=await discordTranscripts[_0x4e6b04(0x193)](_0x4d80c7[_0x4e6b04(0x161)],{'returnType':_0x4e6b04(0x1b0),'poweredBy':![],'limit':-0x1,'saveImages':!![],'footerText':_0x3a8508['user'][_0x4e6b04(0x177)]+_0x4e6b04(0x183)});fs[_0x4e6b04(0x16f)](_0x4e6b04(0x1ad)+_0x241831[_0x4e6b04(0x1bb)]+'-'+_0x4d80c7[_0x4e6b04(0x161)]['id']+_0x4e6b04(0x15f),_0x5cda12,async function(_0x637237){var _0x4f663d=_0x4e6b04;if(_0x637237)console[_0x4f663d(0x1a0)](_0x637237);});}const _0x3d056b=await _0x3a8508[_0x4e6b04(0x1a9)][_0x4e6b04(0x180)](_0x241831['author']);var _0x240386=_0x3d056b[_0x4e6b04(0x176)][_0x4e6b04(0x1c5)](_0x137772=>_0x137772[_0x4e6b04(0x1ce)]===_0x4d80c7['channel']['id']);!_0x240386===-0x1&&(_0x3d056b[_0x4e6b04(0x176)][_0x240386][_0x4e6b04(0x185)]=![],_0x3d056b[_0x4e6b04(0x1b9)]('tickets'),await _0x3d056b[_0x4e6b04(0x1ba)]());utils[_0x4e6b04(0x190)](_0x3a8508,_0x4d80c7[_0x4e6b04(0x1ca)],_0x4d80c7[_0x4e6b04(0x161)],0x1);if(config['support']['ticketPointsSystem']){const _0x2bceaf=[];var _0x454ec8=[];for(let _0x346af6=0x0;_0x346af6<config[_0x4e6b04(0x181)][_0x4e6b04(0x187)]['length'];_0x346af6++){var _0x1936f4=_0x4d80c7[_0x4e6b04(0x160)][_0x4e6b04(0x1c8)][_0x4e6b04(0x1b5)][_0x4e6b04(0x16c)](config['support'][_0x4e6b04(0x187)][_0x346af6])[_0x4e6b04(0x194)][_0x4e6b04(0x174)](_0x443341=>_0x443341);for(let _0x3b64e2=0x0;_0x3b64e2<_0x1936f4[_0x4e6b04(0x198)];_0x3b64e2++){!_0x454ec8[_0x4e6b04(0x19d)](_0x325294=>_0x325294[_0x4e6b04(0x1ca)]['id']===_0x1936f4[_0x3b64e2][_0x4e6b04(0x1ca)]['id'])&&_0x454ec8['push'](_0x1936f4[_0x3b64e2]);}}var _0x2a2fe4=moment()['format']('-DD/MM/YYYY\x20HH:mm.ss');_0x3a8508[_0x4e6b04(0x175)][_0x4e6b04(0x1b5)]['get'](_0x4d80c7[_0x4e6b04(0x161)]['id'])[_0x4e6b04(0x172)][_0x4e6b04(0x169)]()[_0x4e6b04(0x1c7)](async _0x25ca7e=>{var _0x3b46b4=_0x4e6b04;for(let _0x2a3dda=0x0;_0x2a3dda<_0x454ec8[_0x3b46b4(0x198)];_0x2a3dda++){const _0x2122d9=_0x25ca7e[_0x3b46b4(0x179)](_0x275392=>_0x275392[_0x3b46b4(0x182)]['id']===_0x454ec8[_0x2a3dda][_0x3b46b4(0x1ca)]['id']);var _0x4e025f=0x0;_0x2122d9[_0x3b46b4(0x19e)](_0x3ea486=>_0x4e025f+=_0x3ea486[_0x3b46b4(0x18d)][_0x3b46b4(0x198)]),_0x2bceaf['push']({'messages':_0x4e025f,'user':_0x454ec8[_0x2a3dda][_0x3b46b4(0x1ca)]['id']});if(_0x2a3dda===_0x454ec8[_0x3b46b4(0x198)]-0x1){_0x2bceaf[_0x3b46b4(0x197)](function(_0xd41a2c,_0x1f395a){var _0x297e2d=_0x3b46b4;return _0x1f395a['messages']-_0xd41a2c[_0x297e2d(0x172)];});if(_0x2bceaf[0x0]['messages']===0x0){var _0x2de911=new Discord[(_0x3b46b4(0x17c))]()[_0x3b46b4(0x171)](config[_0x3b46b4(0x172)][_0x3b46b4(0x1a5)][_0x3b46b4(0x192)]['closeLogNoPoints'][_0x3b46b4(0x1a1)])[_0x3b46b4(0x162)]({'name':config['messages'][_0x3b46b4(0x1a5)][_0x3b46b4(0x192)][_0x3b46b4(0x1b7)][_0x3b46b4(0x182)]})[_0x3b46b4(0x1a3)](config[_0x3b46b4(0x172)][_0x3b46b4(0x1a5)][_0x3b46b4(0x192)][_0x3b46b4(0x1b7)][_0x3b46b4(0x189)][_0x3b46b4(0x1a2)](_0x3b46b4(0x1b8),_0x3b46b4(0x18a)));_0x3a8508['channels']['cache'][_0x3b46b4(0x16c)](config[_0x3b46b4(0x181)][_0x3b46b4(0x19a)])[_0x3b46b4(0x1ab)]({'embeds':[_0x2de911]});return;}var _0x52df23=[],_0x323fd4=0x0;for(let _0x336d70=0x0;_0x336d70<_0x2bceaf[_0x3b46b4(0x198)];_0x336d70++){if(_0x2bceaf[_0x336d70][_0x3b46b4(0x172)]!=(_0x2bceaf[_0x336d70+0x1]?_0x2bceaf[_0x336d70+0x1][_0x3b46b4(0x172)]:'')){_0x323fd4=_0x336d70;break;}}while(_0x323fd4>=0x0){_0x52df23[_0x3b46b4(0x196)](_0x2bceaf[_0x323fd4]['user']);var _0x23b342=await _0x3a8508[_0x3b46b4(0x1a9)]['fetchStaffChn'](_0x2bceaf[_0x323fd4][_0x3b46b4(0x1ca)],_0x4d80c7[_0x3b46b4(0x161)]['id']);_0x23b342[_0x3b46b4(0x173)]=_0x2bceaf[_0x323fd4][_0x3b46b4(0x172)],_0x23b342[_0x3b46b4(0x19f)]=_0x2a2fe4,_0x23b342[_0x3b46b4(0x1b9)](_0x3b46b4(0x173)),_0x23b342[_0x3b46b4(0x1b9)](_0x3b46b4(0x19f)),await _0x23b342[_0x3b46b4(0x1ba)](),_0x323fd4-=0x1;}var _0x2873d0=[];for(let _0x2d24e7=0x0;_0x2d24e7<_0x52df23[_0x3b46b4(0x198)];_0x2d24e7++){_0x2873d0[_0x3b46b4(0x196)]('<@'+_0x52df23[_0x2d24e7]+_0x3b46b4(0x191)+_0x2bceaf[_0x2d24e7][_0x3b46b4(0x172)]+'`');}var _0x2153c3=new Discord['EmbedBuilder']()[_0x3b46b4(0x171)](config[_0x3b46b4(0x172)][_0x3b46b4(0x1a5)][_0x3b46b4(0x192)]['closeLogPoints'][_0x3b46b4(0x1a1)])['setAuthor']({'name':config['messages']['commands']['close']['closeLogPoints']['author']})[_0x3b46b4(0x1a3)]('Talep:\x20`'+_0x4d80c7['channel'][_0x3b46b4(0x1a7)]+_0x3b46b4(0x18b)+(_0x52df23[_0x3b46b4(0x198)]>0x1?'ler':'')+':\x0a'+_0x2873d0[_0x3b46b4(0x1c6)]('\x0a'));await _0x3a8508[_0x3b46b4(0x175)][_0x3b46b4(0x1b5)][_0x3b46b4(0x16c)](config[_0x3b46b4(0x181)][_0x3b46b4(0x19a)])[_0x3b46b4(0x1ab)]({'embeds':[_0x2153c3]});}}});}config['support'][_0x4e6b04(0x1b1)]&&utils[_0x4e6b04(0x1ac)](_0x3a8508,_0x4d80c7[_0x4e6b04(0x161)]),setTimeout(async()=>{var _0x32d481=_0x4e6b04;if(config[_0x32d481(0x181)][_0x32d481(0x163)]){await _0x4d80c7[_0x32d481(0x161)][_0x32d481(0x1c2)](config['support'][_0x32d481(0x166)]);for(let _0x31166c=0x0;_0x31166c<_0x241831[_0x32d481(0x194)]['length'];_0x31166c++){await _0x4d80c7[_0x32d481(0x161)][_0x32d481(0x1af)][_0x32d481(0x1ae)](_0x241831[_0x32d481(0x194)][_0x31166c],{'ViewChannel':![]});}await _0x4d80c7[_0x32d481(0x161)]['permissionOverwrites']['edit'](_0x4d80c7[_0x32d481(0x160)][_0x32d481(0x1c8)][_0x32d481(0x1b4)]['id'],{'ViewChannel':![]});for(let _0x411b0f=0x0;_0x411b0f<config[_0x32d481(0x181)]['staffRoles'][_0x32d481(0x198)];_0x411b0f++){await _0x4d80c7[_0x32d481(0x161)][_0x32d481(0x1af)][_0x32d481(0x1ae)](config[_0x32d481(0x181)]['staffRoles'][_0x411b0f],{'ViewChannel':!![],'SendMessages':!![]});}var _0x2dc8a1=new Discord['EmbedBuilder']()[_0x32d481(0x171)]('NotQuiteBlack')['setDescription'](_0x32d481(0x167)['replace']('-user-','<@'+_0x4d80c7[_0x32d481(0x1ca)]['id']+'>')),_0x49046e=new Discord[(_0x32d481(0x1b2))]()[_0x32d481(0x17b)](config[_0x32d481(0x172)][_0x32d481(0x176)]['general'][_0x32d481(0x17d)][_0x32d481(0x1a4)][_0x32d481(0x1bd)])['setEmoji'](config[_0x32d481(0x172)][_0x32d481(0x176)][_0x32d481(0x1bf)]['closedEmbed']['reopenbtn'][_0x32d481(0x1c9)])[_0x32d481(0x1c0)](_0x32d481(0x1be))[_0x32d481(0x188)](0x2),_0x1fc609=new Discord['ButtonBuilder']()['setLabel'](config[_0x32d481(0x172)]['tickets'][_0x32d481(0x1bf)][_0x32d481(0x17d)]['deletebtn']['label'])[_0x32d481(0x1cc)](config['messages'][_0x32d481(0x176)]['general'][_0x32d481(0x17d)][_0x32d481(0x1bc)][_0x32d481(0x1c9)])['setCustomId'](_0x32d481(0x1cf))[_0x32d481(0x188)](0x2),_0x51b40d=new Discord['ActionRowBuilder']()[_0x32d481(0x1d0)]([_0x49046e,_0x1fc609]);_0x4d80c7[_0x32d481(0x195)]({'embeds':[_0x2dc8a1],'components':[_0x51b40d]});}else await _0x4d80c7[_0x32d481(0x161)]['delete']();},0x3e8);},0x111*0x28);});

const cmd = new Discord.SlashCommandBuilder()
.setDMPermission(false)
.setName("closeticket")
.setDescription("Aktif bir destek talebini kapatır.")

exports.data = cmd.toJSON()